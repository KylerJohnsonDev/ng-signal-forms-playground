<div class="container">
    <h2>Patient Intake Form</h2>

    <div class="stepper">
        <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">1. Patient Info</div>
        <div class="line"></div>
        <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">2. Medical History
        </div>
        <div class="line"></div>
        <div class="step" [class.active]="currentStep === 3">3. Insurance & Consent</div>
    </div>

    <form (submit)="$event.preventDefault(); onSubmit()">

        <!-- Step 1: Patient Info -->
        <div *ngIf="currentStep === 1" class="form-step">
            <h3>Step 1: Patient Information</h3>

            <div class="form-group">
                <label for="fullName">Full Name *</label>
                <input id="fullName" type="text" [field]="intakeForm.fullName" placeholder="Enter full name">
                @if (intakeForm.fullName().invalid()) {
                <div class="error">
                    @for (error of intakeForm.fullName().errors(); track error) {
                    {{ error.message }}
                    }
                </div>
                }
            </div>

            <div class="form-group">
                <label for="dob">Date of Birth *</label>
                <input id="dob" type="date" [field]="intakeForm.dateOfBirth">
                @if (intakeForm.dateOfBirth().invalid()) {
                <div class="error">
                    @for (error of intakeForm.dateOfBirth().errors(); track error) {
                    {{ error.message }}
                    }
                </div>
                }
            </div>

            <div class="form-group">
                <label for="gender">Gender</label>
                <select id="gender" [field]="intakeForm.gender">
                    <option value="">Select Gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                    <option value="prefer-not-to-say">Prefer not to say</option>
                </select>
            </div>

            <div class="form-group">
                <label for="phone">Phone Number *</label>
                <input id="phone" type="tel" [field]="intakeForm.phoneNumber" placeholder="(555) 555-5555">
                @if (intakeForm.phoneNumber().invalid()) {
                <div class="error">
                    @for (error of intakeForm.phoneNumber().errors(); track error) {
                    {{ error.message }}
                    }
                </div>
                }
            </div>
        </div>

        <!-- Step 2: Medical History -->
        <div *ngIf="currentStep === 2" class="form-step">
            <h3>Step 2: Medical History</h3>

            <div class="form-group">
                <label for="complaint">Primary Complaint *</label>
                <textarea id="complaint" [field]="intakeForm.primaryComplaint" rows="3"
                    placeholder="Describe your main reason for visiting"></textarea>
                @if (intakeForm.primaryComplaint().invalid()) {
                <div class="error">
                    @for (error of intakeForm.primaryComplaint().errors(); track error) {
                    {{ error.message }}
                    }
                </div>
                }
            </div>

            <div class="form-group">
                <label for="allergies">Allergies</label>
                <textarea id="allergies" [field]="intakeForm.allergies" rows="2"
                    placeholder="List any allergies"></textarea>
            </div>

            <div class="form-group">
                <label for="medications">Current Medications</label>
                <textarea id="medications" [field]="intakeForm.medications" rows="2"
                    placeholder="List current medications"></textarea>
            </div>
        </div>

        <!-- Step 3: Insurance & Consent -->
        <div *ngIf="currentStep === 3" class="form-step">
            <h3>Step 3: Insurance & Consent</h3>

            <div class="form-group">
                <label for="insurance">Insurance Provider</label>
                <input id="insurance" type="text" [field]="intakeForm.insuranceProvider" placeholder="Provider Name">
            </div>

            <div class="form-group">
                <label for="policy">Policy Number</label>
                <input id="policy" type="text" [field]="intakeForm.policyNumber" placeholder="Policy #">
            </div>

            <div class="form-group checkbox-group">
                <label>
                    <input type="checkbox" [field]="intakeForm.consentToTreat"> I consent to treatment and agree to the
                    clinic's policies. *
                </label>
                @if (intakeForm.consentToTreat().invalid()) {
                <div class="error">
                    @for (error of intakeForm.consentToTreat().errors(); track error) {
                    {{ error.message }}
                    }
                </div>
                }
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="actions">
            <button type="button" (click)="prevStep()" [disabled]="currentStep === 1"
                class="btn-secondary">Previous</button>
            <button type="button" (click)="nextStep()" *ngIf="currentStep < 3" class="btn-primary">Next</button>
            <button type="submit" *ngIf="currentStep === 3" class="btn-success"
                [disabled]="intakeForm.consentToTreat().invalid()">Submit</button>
        </div>

    </form>
</div>